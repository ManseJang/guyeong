import streamlit as st
import openai
import os

openai.api_key = st.secrets["api_key"]

client = openai.OpenAI()


# Streamlit app title and caption
st.title("êµ¬ì˜ì´ˆ í•™ì‚¬ì¼ì •")
st.caption("êµ¬ì˜ì´ˆë“±í•™êµì˜ í•™ì‚¬ì¼ì •ì„ ë¬¼ì–´ë³¼ ìˆ˜ ìˆëŠ” ì±—ë´‡ì…ë‹ˆë‹¤.")

# ì„¸ì…˜ ìƒíƒœì— ë©”ì‹œì§€ê°€ ì—†ìœ¼ë©´ ì´ˆê¸°í™”
if "messages" not in st.session_state:
    st.session_state["messages"] = [{"role": "assistant", "content": "í–‰ì‚¬ëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”"}]

# ì´ì „ ì±„íŒ… ë©”ì‹œì§€ í‘œì‹œ

for msg in st.session_state.messages:
    if msg["role"] == "assistant":
         st.markdown(f"**ğŸ¤– Assistant:** {msg['content']}")
    else:
        st.markdown(f"**ğŸ‘¤ You:** {msg['content']}")

# ì‚¬ìš©ì ì…ë ¥ ì²˜ë¦¬
prompt = st.text_input("ì§ˆë¬¸ì„ ì…ë ¥í•˜ì„¸ìš”:", key="input")

if prompt:
    # ì‚¬ìš©ì ë©”ì‹œì§€ ì €ì¥
    st.session_state.messages.append({"role": "user", "content": prompt})
    st.markdown(f"**ğŸ‘¤ You:** {prompt}")
    
    # OpenAI API í˜¸ì¶œ
    response = client.chat.completions.create(
        model="gpt-4o", 
        messages=[
            {"role": "system", "content": '''êµ¬ì˜ì´ˆë“±í•™êµì˜ í•™ì‚¬ì¼ì •ì„ ì•Œë ¤ì¤˜ë¼. ê²½ì–´ì²´ë¡œ ë‹µë³€í•˜ì—¬ë¼.
             ì‚¼ì¼ì ˆ: 3ì›” 1ì¼, ì…í•™ì‹ ë° ê°œí•™ì‹: 3ì›” 4ì¼, ì¸ì„±ì£¼ê°„: 3ì›” 5ì¼ ~ 3ì›” 8ì¼, ê¸°ì´ˆí•™ë ¥ ì§„ë‹¨ê²€ì‚¬: 3ì›” 11ì¼~ 3ì›” 13ì¼
             í•™ë¶€ëª¨ ì´íšŒ: 3ì›” 15ì¼, êµìœ¡ê³¼ì • ì„¤ëª…íšŒ: 3ì›” 20ì¼, ì„ í–‰êµìœ¡ ê·¼ì ˆ êµìœ¡: 3ì›” 26ì¼ ~ 3ì›” 28ì¼, ì „êµí•™ìƒíšŒ ì„ ê±°: 4ì›” 10ì¼, 
             1í•™ê¸° í•™ì—…ì„±ì·¨ë„ í‰ê°€: 4ì›” 1ì¼ ~ 4ì›” 5ì¼(2~6í•™ë…„), ê³¼í•™ì˜ ë‚  í–‰ì‚¬: 4ì›” 17ì¼ ~ 4ì›” 19ì¼, ì¥ì• ì¸ì˜ ë‚ : 4ì›” 19ì¼,
             ìœµí•©êµìœ¡(STEAM) ì£¼ê°„: 4ì›” 22ì¼ ~ 4ì›” 24ì¼, ìƒëª…ì¡´ì¤‘ì‚¬ë‘ ìƒëª…êµìœ¡ ì£¼ê°„: 4ì›” 29ì¼ ~ 4ì›” 30ì¼, ê·¼ë¡œìì˜ ë‚ : 5ì›” 1ì¼,
             ëŒ€ì¤‘êµí†µ ì´ìš©ì˜ ë‚ : 5ì›” 3ì¼, ì§„ë¡œêµìœ¡: 5ì›” 4ì¼ ~ 5ì›” 9ì¼(4~6í•™ë…„), ëŒ€í•™íƒë°©: 5ì›” 16ì¼ ~ 5ì›” 17ì¼(6í•™ë…„), 
             ì¬ë‚œì•ˆì „êµìœ¡ì£¼ê°„: 5ì›” 20ì¼ ~ 5ì›” 22ì¼, ì¬ë‚œëŒ€í”¼í›ˆë ¨: 5ì›” 28ì¼, í™˜ê²½êµìœ¡ ì£¼ê°„: 6ì›” 3ì¼ ~ 6ì›” 7ì¼, í˜„ì¶©ì¸ 6ì›” 8ì¼, 
             ê¸ˆìœµ, êµí†µ, ë§ˆì•½, ìŒì£¼ìš´ì „ ì˜ˆë°©êµìœ¡: 6ì›” 10ì¼ ~ 6ì›” 14ì¼, ë°©ê³¼í›„ êµìœ¡ ë°©í‘œíšŒ: ã…‘6ì›” 15ì¼, ì†Œë°©ëŒ€í”¼í›ˆë ¨: 6ì›” 26ì¼~ 6ì›” 28ì¼,
             í•™ì˜ˆë°œí‘œíšŒ: 7ì›” 22ì¼ ~ 7ì›” 24ì¼, ì—¬ë¦„ ë°©í•™ì‹: 7ì›” 25ì¼, 2í•™ê¸° ê°œí•™ì‹: 8ì›” 26ì¼, ë…ì„œêµìœ¡ì£¼ê°„: 9ì›” 18ì¼ ~ 9ì›” 20ì¼,
             í•™êµí­ë ¥ì˜ˆë°©êµìœ¡: 9ì›” 26ì¼ ~ 9ì›” 27ì¼, 2í•™ê¸° ìƒë‹´ ì£¼ê°„ ì‹œì‘: 9ì›” 30ì¼, ì˜ˆìˆ  êµìœ¡ ì£¼ê°„: 10ì›” 24ì¼ ~ 10ì›” 25ì¼, 
             í•©ë™ì†Œë°©í›ˆë ¨: 10ì›” 28ì¼ ~ 10ì›” 29ì¼, ì•„ë™í•™ëŒ€ ì˜ˆë°© êµìœ¡: 11ì›” 11ì¼ ~ 11ì›” 15ì¼, ê²¨ìš¸ë°©í•™ì‹ ì¢…ì—…ì‹: 25ë…„ 1ì›” 10ì¼
             ì´ ì´ì™¸ì˜ í–‰ì‚¬ì— ëŒ€í•´ì„œ ì§ˆë¬¸ì´ ë“¤ì–´ì˜¤ë©´ ì£„ì†¡í•©ë‹ˆë‹¤. ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤ ë¼ê³  ëŒ€ë‹µí•˜ì—¬ë¼.'''},
            {"role": "user", "content": prompt}
        ]
    )
    
    # Assistantì˜ ì‘ë‹µ ì¶œë ¥
    msg = response.choices[0].message.content
    st.session_state.messages.append({"role": "assistant", "content": msg})
    st.markdown(f"**ğŸ¤– Assistant:** {msg}")
